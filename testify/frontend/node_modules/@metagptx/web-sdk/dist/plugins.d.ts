//#region src/types/plugins.d.ts
/**
 * Vite 插件相关类型定义
 */

// ==================== vite-plugin-routes 类型 ====================

interface RouteInfo {
  /** 完整路由路径 */
  path: string;
  /** 是否有 element（即是否为可访问页面） */
  hasElement: boolean;
  /** element 组件名称（如果可识别） */
  elementName?: string;
  /** 是否为通配符路由 */
  isWildcard: boolean;
  /** 是否为 index 路由 */
  isIndex: boolean;
  /** 子路由 */
  children?: RouteInfo[];
}
interface RoutesManifest {
  /** 所有路由（树形结构） */
  routeTree: RouteInfo[];
  /** 扁平化的路由列表（只包含有 element 的路由） */
  routes: Array<{
    path: string;
    elementName?: string;
  }>;
  /** 可访问页面总数（排除通配符和纯布局路由） */
  pageCount: number;
  /** 所有路由总数 */
  total: number;
  /** 生成时间戳 */
  generatedAt: string;
}
interface PluginRoutesOptions {
  /**
   * 路由文件路径
   * @default 'src/App.tsx'
   */
  routeFile?: string;

  /**
   * 入口文件路径，用于自动注入
   * @default 'src/main.tsx'
   */
  entryFile?: string;

  /**
   * 虚拟模块 ID
   * @default 'virtual:routes-manifest'
   */
  moduleId?: string;

  /**
   * 是否自动向父级 iframe 发送路由信息
   * @default true
   */
  notifyParent?: boolean;

  /**
   * 发送给父级的消息类型标识
   * @default 'ROUTES_MANIFEST'
   */
  messageType?: string;

  /**
   * 要排除的路由路径模式
   * @default ['*']
   */
  excludePaths?: string[];
}

// ==================== vite-plugin-404 类型 ====================

// vite-plugin-404 目前不需要配置选项

// ==================== atomsPlugins 容器类型 ====================

interface Plugin404Options {
  /**
   * 是否启用 404 插件
   * @default true
   */
  enable?: boolean;
}
interface AtomsPluginRoutesOptions extends PluginRoutesOptions {
  /**
   * 是否启用路由扫描插件
   * @default true
   */
  enable?: boolean;
}
interface AtomsPluginOptions {
  /**
   * 404 页面插件配置
   */
  '404'?: Plugin404Options;

  /**
   * 路由扫描插件配置
   */
  routes?: AtomsPluginRoutesOptions;
}
//#endregion
//#region src/plugins/vite-plugin-atoms.d.ts
/**
 * 与 Vite Plugin 结构兼容的类型，在 SDK 内定义以避免依赖具体 Vite 实例。
 * 这样在 monorepo 或消费者自备 Vite 时，atoms() 的返回值可被任意 Vite 的 plugins 数组接受。
 */
type VitePluginCompatible = {
  name: string;
  enforce?: 'pre' | 'post';
  apply?: 'build' | 'serve' | ((config: unknown, env: unknown) => boolean);
  [key: string]: unknown;
};
/** 单个插件或插件数组，可直接作为 plugins 数组的一项（如 atoms()） */
type VitePluginOption = VitePluginCompatible | VitePluginCompatible[];
/**
 * Atoms Vite 插件容器
 *
 * 整合了 404 页面插件和路由扫描插件
 *
 * @example
 * ```ts
 * // vite.config.ts
 * import { atoms } from '@metagptx/web-sdk/plugins';
 *
 * export default defineConfig({
 *   plugins: [
 *     atoms(),
 *   ],
 * });
 * ```
 *
 * @example
 * ```ts
 * // 自定义配置
 * atomsPlugins({
 *   '404': { enable: true },
 *   routes: {
 *     enable: true,
 *     routeFile: 'src/App.tsx',
 *     notifyParent: true,
 *   },
 * })
 * ```
 */
declare function atoms(options?: AtomsPluginOptions): VitePluginOption;
//#endregion
export { type AtomsPluginOptions, type AtomsPluginRoutesOptions, type Plugin404Options, type PluginRoutesOptions, type RouteInfo, type RoutesManifest, type VitePluginCompatible, type VitePluginOption, atoms };